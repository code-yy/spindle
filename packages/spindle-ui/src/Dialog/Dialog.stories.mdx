import { useEffect, useRef } from 'react';
import { Description, Meta, Story, Source } from '@storybook/addon-docs/blocks';
import { DialogExample, StyleOnly, ButtonRow, ButtonColumn, ButtonColumnWithSubtleButton } from './Dialog.stories.example';

# Dialog

<Meta title="Dialog" />

![stability-experimental](https://img.shields.io/badge/stability-experimental-orange.svg)

<Source
  language='javascript'
  code={`import { Dialog } from '@openameba/spindle-ui'`}
/>

<Source
  language='css'
  code={`@import './node_modules/@openameba/spindle-ui/Dialog/Dialog.css'`}
/>

<Source
  language='html'
  code={`<link rel="stylesheet" href="https://unpkg.com/@openameba/spindle-ui/Dialog/Dialog.css">`}
/>

## Dialog

Dialogは、利用者に重要な意思決定を促す時に利用されます。Spindle UIのDialogは[HTMLDialogElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement)を利用して作られています。[非対応ブラウザ](https://caniuse.com/dialog)には[dialog polyfill](https://github.com/GoogleChrome/dialog-polyfill)と併用してください。

また、`<dialog>`要素には`<form method="dialog">`要素が内包されているため、以下の動作が想定されています。

- `<Button>`を挿入するとデフォルトでは`type=submit`が指定されるため、ダイアログを閉じるボタンになります
- `<Dialog>`は`open`プロパティの値を見て、開く・閉じるの動作を行います。多くのケースでは`onClose`と`onCancel`両方のタイミングで`open`プロパティに`false`を指定し、ダイアログを閉じます
  - `onCancel`イベントはEscapeキーを押されたなどデバイスや支援技術から伝達されます。キャンセル時にログ送信や特別な処理を行いたい場合は指定してください

<Preview withSource="open">
  <Story name="Normal">
    <DialogExample />
  </Story>
</Preview>

<Source
  code={`
function DialogExample() {
  const [open, setOpen] = useState(false);
  const dialogRef = useRef(null);
  const handleOpenButtonClick = () => setOpen(true);
  const handleDialogCancel = () => setOpen(false);
  const handleDialogClose = () => setOpen(false);
  useEffect(() => {
    if (dialogRef.current) {
      dialogPolyfill.registerDialog(dialogRef.current);
    }
  }, [dialogRef]);
  return (
    <>
      <Button
        aria-haspopup="true"
        onClick={handleOpenButtonClick}
        size="medium"
      >
        Open Dialog
      </Button>
      <Dialog.Frame
        aria-describedby="dialog-description"
        aria-labelledby="dialog-title"
        ref={dialogRef}
        open={open}
        onCancel={handleDialogCancel}
        onClose={handleDialogClose}
      >
        <Dialog.Title id="dialog-title">タイトルですよ</Dialog.Title>
        <Dialog.Body id="dialog-description">
          ここに本文が入りますよ
        </Dialog.Body>
        <Dialog.ButtonGroup>
          <Button layout="fullWidth" size="medium">
            OK
          </Button>
        </Dialog.ButtonGroup>
      </Dialog.Frame>
    </>
  );
}
  `}
/>

## StyleOnly

[HTMLDialogElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement)を利用しない場合には、`<Dialog.StyleOnly>`を利用しSpindleで定義されたスタイルを流用できます。ダイアログの動作を独自で定義したい場合や他ライブラリの利用等でスタイルだけ使いたい場合を想定しています。

<Preview withSource="open">
  <Story name="StyleOnly">
    <StyleOnly />
  </Story>
</Preview>

<Source
  code={`
function DialogExample() {
  return (
    <Dialog.StyleOnly>
      <Dialog.Title>タイトルですよ</Dialog.Title>
      <Dialog.Body>ここに本文が入りますよ</Dialog.Body>
      <Dialog.ButtonGroup>
        <Button layout="fullWidth" size="medium">OK</Button>
      </Dialog.ButtonGroup>
    </Dialog.StyleOnly>
  );
}
  `}
/>

<Source
  code={`
<div class="spui-Dialog">
  <p class="spui-Dialog-title">タイトルですよ</p>
  <p class="spui-Dialog-body">ここに本文が入りますよ</p>
  <div class="spui-ButtonGroup spui-ButtonGroup--row spui-ButtonGroup--medium spui-Dialog-buttonGroup">
    <button class="spui-Button spui-Button--fullWidth spui-Button--medium spui-Button--contained">OK</button>
  </div>
</div>
  `}
/>

## ButtonGroup

`<Dialog.ButtonGroup>`を利用して、ボタンの並ぶ方向を横・縦に指定できます。ボタンは`<Button>`のmediumサイズを利用してください。

<Preview withSource="open">
  <Story name="ButtonRow">
    <ButtonRow />
  </Story>
</Preview>

<Source
  code={`
function DialogExample() {
  return (
    <Dialog.StyleOnly>
      <Dialog.Title>タイトルですよ</Dialog.Title>
      <Dialog.Body>ここに本文が入りますよ</Dialog.Body>
      <Dialog.ButtonGroup>
        <Button layout="fullWidth" size="medium" variant="neutral">
          キャンセル
        </Button>
        <Button layout="fullWidth" size="medium" variant="danger">
          削除する
        </Button>
      </Dialog.ButtonGroup>
    </Dialog.StyleOnly>
  );
}
  `}
/>

<Source
  code={`
<div class="spui-Dialog">
  <p class="spui-Dialog-title">タイトルですよ</p>
  <p class="spui-Dialog-body">ここに本文が入りますよ</p>
  <div class="spui-ButtonGroup spui-ButtonGroup--row spui-ButtonGroup--medium spui-Dialog-buttonGroup">
    <button class="spui-Button spui-Button--fullWidth spui-Button--medium spui-Button--neutral">キャンセル</button>
    <button class="spui-Button spui-Button--fullWidth spui-Button--medium spui-Button--danger" type="button">削除する</button>
  </div>
</div>
  `}
/>

<Preview withSource="open">
  <Story name="ButtonColumn">
    <ButtonColumn />
  </Story>
</Preview>

<Source
  code={`
function DialogExample() {
  return (
    <Dialog.StyleOnly>
      <Dialog.Title>タイトルですよ</Dialog.Title>
      <Dialog.Body>ここに本文が入りますよ</Dialog.Body>
      <Dialog.ButtonGroup direction="column">
        <Button layout="fullWidth" size="medium">
          Spindleをフォローする
        </Button>
        <Button layout="fullWidth" size="medium" variant="neutral">
          キャンセル
        </Button>
      </Dialog.ButtonGroup>
    </Dialog.StyleOnly>
  );
}
  `}
/>

<Source
  code={`
<div class="spui-Dialog">
  <p class="spui-Dialog-title">タイトルですよ</p>
  <p class="spui-Dialog-body">ここに本文が入りますよ</p>
  <div class="spui-ButtonGroup spui-ButtonGroup--column spui-ButtonGroup--medium spui-Dialog-buttonGroup">
    <button class="spui-Button spui-Button--fullWidth spui-Button--medium spui-Button--contained" type="button">Spindleをフォローする</button>
    <button class="spui-Button spui-Button--fullWidth spui-Button--medium spui-Button--neutral">キャンセル</button>
  </div>
</div>
  `}
/>

<Preview withSource="open">
  <Story name="ButtonColumnWithSubtleButton">
    <ButtonColumnWithSubtleButton />
  </Story>
</Preview>

<Source
  code={`
function DialogExample() {
  return (
    <Dialog.StyleOnly>
      <Dialog.Title>タイトルですよ</Dialog.Title>
      <Dialog.Body>ここに本文が入りますよ</Dialog.Body>
      <Dialog.ButtonGroup direction="column">
        <Button layout="fullWidth" size="medium">
          Spindleをフォローする
        </Button>
        <SubtleButton size="medium">
          閉じる
        </Button>
      </Dialog.ButtonGroup>
    </Dialog.StyleOnly>
  );
}
  `}
/>

<Source
  code={`
<div class="spui-Dialog">
  <p class="spui-Dialog-title">タイトルですよ</p>
  <p class="spui-Dialog-body">ここに本文が入りますよ</p>
  <div class="spui-ButtonGroup spui-ButtonGroup--column spui-ButtonGroup--medium spui-Dialog-buttonGroup">
    <button class="spui-Button spui-Button--fullWidth spui-Button--medium spui-Button--contained" type="button">Spindleをフォローする</button>
    <button class="spui-SubtleButton spui-SubtleButton--medium">閉じる</button>
  </div>
</div>
  `}
/>
